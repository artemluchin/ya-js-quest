function DoorBase(t,e){function o(){this.isDisabled||this.openPopup()}function r(){this.closePopup()}this.number=t,this.onUnclockCallback=e,this.level=document.querySelector(".level_"+t),this.door=document.querySelector(".door_level_"+t),this.popup=document.querySelector(".popup_level_"+t),this.close=this.popup.querySelector(".popup__close"),this.isLocked=!0,this.isDisabled=this.door.classList.contains("door_disabled"),this.door.addEventListener("click",o.bind(this)),this.close.addEventListener("click",r.bind(this))}function Door0(t,e){function o(t){t.target.classList.add("door-riddle__button_pressed"),t.target.classList.contains("door-riddle__button_"+n[0])&&n.shift(),0==n.length&&this.unlock()}function r(t){t.target.classList.remove("door-riddle__button_pressed"),n=[1,2,0]}DoorBase.apply(this,arguments);var n=[0,2,1],i=[this.popup.querySelector(".door-riddle__button_0"),this.popup.querySelector(".door-riddle__button_1"),this.popup.querySelector(".door-riddle__button_2")];i.forEach(function(t){t.addEventListener("pointerdown",o.bind(this)),t.addEventListener("pointerup",r.bind(this)),t.addEventListener("pointercancel",r.bind(this)),t.addEventListener("pointerleave",r.bind(this))}.bind(this))}function Door1(t,e){function o(t){return t/L*(E-q)-D+"px"}function r(t){return t/L*(b-y)+y}function n(t,e,o,r){return Math.sqrt(Math.pow(t-e,2)+Math.pow(o-r,2))}function i(){requestAnimationFrame(function(){v.style.transform="translateY("+o(m)+")",u.style.transform="translate(-50%,"+o(m)+") scale("+r(m)+")"})}function s(t){var e=0,o=0;_.forEach(function(e){e.id===t.pointerId&&(e.x=t.pageX,e.y=t.pageY)});for(var r=0;r<_.length-1;r++)r==_.length-1?(e+=n(_[r].x,_[0].x,_[r].y,_[0].y),o+=n(_[r].prevX,_[0].prevX,_[r].prevY,_[0].prevY)):(e+=n(_[r].x,_[r+1].x,_[r].y,_[r+1].y),o+=n(_[r].prevX,_[r+1].prevX,_[r].prevY,_[r+1].prevY));return _.forEach(function(e){e.id===t.pointerId&&(e.prevX=t.pageX,e.prevY=t.pageY)}),e>o?"zoomIn":e<o?"zoomOut":void 0}function p(t){_.push({id:t.pointerId,x:t.pageX,y:t.pageY,prevX:t.pageX,prevY:t.pageY})}function a(t){var e=s(t);"zoomIn"===e?(2==_.length?m+=1:3==_.length?m+=10:4==_.length&&(m+=50),m>L&&(m=L),i()):"zoomOut"===e&&(2==_.length?m-=1:3==_.length?m-=10:4==_.length&&(m-=50),m<k&&(m=k),i()),c.apply(this)}function d(t){_.forEach(function(e,o){e.id===t.pointerId&&_.splice(o,1)})}function c(){m==g&&this.unlock()}DoorBase.apply(this,arguments);var l=this.popup;l.addEventListener("pointerdown",p.bind(this)),l.addEventListener("pointerup",d.bind(this)),l.addEventListener("pointermove",a.bind(this)),l.addEventListener("pointercancel",d.bind(this)),l.addEventListener("pointerleave",d.bind(this));var u=this.popup.querySelector(".door-riddle__kettlebell"),h=this.popup.querySelector(".door-riddle__container"),f=this.popup.querySelector(".door-riddle__target-point"),v=this.popup.querySelector(".door-riddle__support"),_=[],b=1.5,y=.5,g=5763,m=1200,L=1e4,k=1,E=h.offsetTop+h.offsetHeight,q=h.offsetTop,D=m/L*(E-q);f.style.top=g/L*(E-q)-f.offsetHeight/2+"px",v.style.top=m/L*(E-q)-v.offsetHeight/2+"px",u.style.top=v.offsetTop-u.offsetHeight+"px",u.style.transform="translateX(-50%) scale("+r(m)+")"}function Door2(t,e){function o(t){t.target.classList.add("door-riddle__block_pressed"),p.push({id:t.pointerId,x:t.pageX,y:t.clientY})}function r(t){return p.filter(function(e){return e.id===t.pointerId})}function n(t){var e,o,n=t.pageX,i=t.clientY;t.target.classList.contains("door-riddle__block_pressed")&&(t.target.classList.contains("door-riddle__block")&&(e=r(t)[0].x,requestAnimationFrame(function(){t.target.style.transform="translateX("+(n-e)+"px)"})),t.target.classList.contains("door-riddle__rabbit")&&(o=r(t)[0].y,requestAnimationFrame(function(){t.target.style.transform="translate(-50%,"+(i-o)+"px)"}),i>a.offsetTop+a.offsetHeight/2&&this.unlock()))}function i(t){p.forEach(function(e,o){e.id===t.pointerId&&p.splice(o,1)}),t.target.classList.contains("door-riddle__block")&&requestAnimationFrame(function(){t.target.style.transform="translateX(0)"}),t.target.classList.contains("door-riddle__rabbit")&&requestAnimationFrame(function(){t.target.style.transform="translate(-50%,0)"}),t.target.classList.remove("door-riddle__block_pressed")}DoorBase.apply(this,arguments);var s=0,p=[],a=this.popup.querySelector(".door-riddle__carrot"),d=[this.popup.querySelector(".door-riddle__block_0"),this.popup.querySelector(".door-riddle__block_1"),this.popup.querySelector(".door-riddle__block_2"),this.popup.querySelector(".door-riddle__block_3"),this.popup.querySelector(".door-riddle__rabbit")];d.forEach(function(t){t.style.bottom=s+"%",s+=14}),d.forEach(function(t){t.addEventListener("pointerdown",o.bind(this)),t.addEventListener("pointerup",i.bind(this)),t.addEventListener("pointercancel",i.bind(this)),t.addEventListener("pointerleave",i.bind(this)),t.addEventListener("pointermove",n.bind(this))}.bind(this))}function Box(t,e){function o(t,e,o,r){var n=180*Math.atan2(o-r,t-e)/Math.PI;return n<0?n+=360:n}function r(t){l.push({id:t.pointerId,x:t.pageX,y:t.pageY,prevX:t.pageX,prevY:t.pageY})}function n(t){if(l.length>1){l.forEach(function(e){e.id===t.pointerId&&(e.x=t.pageX,e.y=t.pageY)});var e=0,r=0,n=l[0].x,i=l[1].x,p=l[0].y,f=l[1].y,v=l[0].prevX,_=l[1].prevX,b=l[0].prevY,y=l[1].prevY;e=o(i,n,f,p),r=o(_,v,y,b),e>r?(u+=1,s=1,u>360&&(u=0),a.style.transform="rotate("+u+"deg)"):e<r&&(u-=1,s=-1,u<0&&(u+=360),a.style.transform="rotate("+u+"deg)"),Math.abs(u-h.numbers[0])<1&&h.direction==s&&("navigator"in window?window.navigator.vibrate(20):(c.style.opacity=1,setTimeout(function(){c.style.opacity=0},200)),h.numbers.shift(),h.direction*=-1),Math.abs(u-h.numbers[0])<1&&h.direction!==s&&(h.numbers=[115,322,217,72],h.direction=1),1==h.numbers.length&&requestAnimationFrame(function(){d.style.transform="translateX(0)"}),0==h.numbers.length&&this.unlock(),l.forEach(function(e){e.id===t.pointerId&&(e.prevX=t.pageX,e.prevY=t.pageY)})}}function i(t){l.forEach(function(e,o){e.id===t.pointerId&&l.splice(o,1)})}DoorBase.apply(this,arguments);var s,p=this.popup.querySelector(".door-riddle__safelock-disk"),a=this.popup.querySelector(".door-riddle__safelock-disk"),d=this.popup.querySelector(".bonus"),c=this.popup.querySelector(".alert"),l=[],u=0,h={numbers:[115,322,217,72],direction:1};p.addEventListener("pointerdown",r.bind(this)),p.addEventListener("pointerup",i.bind(this)),p.addEventListener("pointermove",n.bind(this)),p.addEventListener("pointercancel",i.bind(this)),p.addEventListener("pointerleave",i.bind(this)),this.showCongratulations=function(){alert("Поздравляю! Игра пройдена!")}}function App(t){function e(){for(var t,e=0;e<o.length;e++)if(o[e].isLocked){if(t&&o[e].isLocked){o[e].enable();break}}else t=!0}var o=[new Door0(0,e),new Door1(1,e),new Door2(2,e),new Box(3,e)];this.doors=o}DoorBase.prototype={openPopup:function(){this.popup.classList.remove("popup_hidden")},closePopup:function(){this.popup.classList.add("popup_hidden")},enable:function(){this.door.classList.remove("door_disabled"),this.isDisabled=!1},unlock:function(){this.door.classList.remove("door_locked"),this.isLocked=!1,this.closePopup(),this.onUnclockCallback(),this.showCongratulations()},showCongratulations:function(){alert("Дверь "+this.number+" открыта!")}},Door0.prototype=Object.create(DoorBase.prototype),Door0.prototype.constructor=DoorBase,Door1.prototype=Object.create(DoorBase.prototype),Door1.prototype.constructor=DoorBase,Door2.prototype=Object.create(DoorBase.prototype),Door2.prototype.constructor=DoorBase,Box.prototype=Object.create(DoorBase.prototype),Box.prototype.constructor=DoorBase;var app=new App(document.querySelector(".app"));